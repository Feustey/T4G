---
alwaysApply: true
description: API Token4Good (T4G) pour t4g.dazno.de - Documentation complÃ¨te et endpoints
---

# ğŸ“˜ API Token4Good (T4G) - Standards d'ImplÃ©mentation

**Base URL**: `https://t4g.dazno.de` ou `https://api.dazno.de/api/v1/token4good`  
**Version**: 1.0  
**DerniÃ¨re mise Ã  jour**: 7 janvier 2025

## ğŸ” Authentification

Token4Good utilise la **mÃªme authentification JWT** que l'API MCP principale.

**Format**:
```
Authorization: Bearer <votre_jwt_token>
```

**Structure JWT requise**:
- `tenant_id`: Identifiant du tenant
- `sub`: user_id ou tenant_id
- `iss`: app.dazno.de
- `aud`: api.dazno.de
- `exp`: Timestamp d'expiration

## ğŸ“š Endpoints Token4Good

### ğŸ‘¥ Gestion des Utilisateurs (`/api/v1/token4good/users`)

#### POST `/users` - CrÃ©er un Profil Utilisateur
**Body**:
```json
{
  "user_id": "t4g_user_001",
  "username": "john_doe",
  "email": "john@example.com",
  "skills": ["lightning-network", "bitcoin", "dazbox"]
}
```

**Response**:
```json
{
  "user_id": "t4g_user_001",
  "username": "john_doe",
  "total_tokens_earned": 50,
  "available_balance": 50,
  "user_level": "contributeur",
  "reputation_score": 0.5,
  "created_at": "2025-01-10T10:00:00Z"
}
```

#### GET `/users/:user_id` - Obtenir un Profil
#### GET `/users/:user_id/statistics` - Statistiques Utilisateur
#### GET `/users/:user_id/opportunities` - OpportunitÃ©s de Gains
#### GET `/leaderboard` - Leaderboard Communautaire

**Query Params**: `?limit=10`

### ğŸ’° Gestion des Tokens (`/api/v1/token4good/tokens`)

#### POST `/tokens/award` - Attribuer des Tokens
**Body**:
```json
{
  "user_id": "t4g_user_001",
  "action_type": "mentoring",
  "tokens": 50,
  "description": "Session Lightning Network complÃ©tÃ©e",
  "metadata": {"session_id": "session_123"},
  "impact_score": 1.3
}
```

**Types d'actions**:
- `mentoring` - Session de mentoring
- `code_review` - Review de code
- `documentation` - CrÃ©ation de documentation
- `support_technique` - Support technique
- `parrainage` - Parrainage de nouveaux membres

**Response**:
```json
{
  "id": "txn_123",
  "user_id": "t4g_user_001",
  "action_type": "mentoring",
  "tokens_earned": 65,
  "timestamp": "2025-01-10T16:00:00Z",
  "impact_score": 1.3
}
```

#### GET `/tokens/:user_id/balance` - Solde de Tokens
**Response**:
```json
{
  "user_id": "t4g_user_001",
  "total_earned": 500,
  "total_spent": 150,
  "available_balance": 350,
  "user_level": "mentor"
}
```

#### GET `/tokens/:user_id/transactions` - Historique des Transactions
**Query Params**: `?limit=50`

### ğŸ“ Sessions de Mentoring (`/api/v1/token4good/mentoring`)

#### POST `/sessions` - CrÃ©er une Session
**Body**:
```json
{
  "mentor_id": "mentor_001",
  "mentee_id": "mentee_001",
  "topic": "Configuration nÅ“ud Lightning",
  "category": "lightning_network",
  "duration_minutes": 60
}
```

**CatÃ©gories**:
- `lightning_network` - Lightning Network Mastery
- `dazbox_setup` - DazBox Setup Pro
- `business_dev` - Bitcoin Business Development
- `dazpay_integration` - DazPay Integration

#### POST `/sessions/complete` - ComplÃ©ter une Session
**Body**:
```json
{
  "session_id": "session_123",
  "feedback": {
    "rating": 5,
    "comments": "Excellent mentoring!",
    "learned_skills": ["node-configuration", "channel-management"]
  }
}
```

#### GET `/sessions/:user_id` - Sessions d'un Utilisateur
**Query Params**: `?as_mentor=true` ou `?as_mentor=false`

### ğŸ›ï¸ Marketplace de Services (`/api/v1/token4good/marketplace`)

#### POST `/services` - CrÃ©er un Service
**Body**:
```json
{
  "provider_id": "provider_001",
  "name": "Migration NÅ“ud Lightning",
  "description": "Migration complÃ¨te et sÃ©curisÃ©e",
  "category": "technical_excellence",
  "token_cost": 300,
  "estimated_duration": "4-6h",
  "requirements": ["nÅ“ud Lightning existant"],
  "tags": ["lightning", "migration", "expert"]
}
```

**CatÃ©gories de services**:
- `technical_excellence` - Services techniques
- `business_growth` - DÃ©veloppement business
- `knowledge_transfer` - Transfert de connaissances
- `community_services` - Services communautaires

#### POST `/search` - Rechercher des Services
**Body**:
```json
{
  "category": "technical_excellence",
  "max_cost": 200,
  "tags": ["lightning", "optimization"],
  "provider_level": "expert"
}
```

#### POST `/book` - RÃ©server un Service
**Body**:
```json
{
  "client_id": "client_001",
  "service_id": "service_123",
  "scheduled_at": "2025-01-15T14:00:00Z",
  "notes": "Besoin urgent"
}
```

#### POST `/bookings/complete` - ComplÃ©ter une RÃ©servation
**Body**:
```json
{
  "booking_id": "booking_123",
  "feedback": {
    "rating": 5,
    "comments": "Service excellent",
    "would_recommend": true
  }
}
```

#### GET `/recommendations/:user_id` - Recommandations PersonnalisÃ©es
**Query Params**: `?limit=5`

#### GET `/stats` - Statistiques Marketplace (Public, pas d'auth)

### ğŸ† Administration (`/api/v1/token4good/admin`)

#### POST `/rewards/weekly-bonuses` - Bonus Hebdomadaires
**Note**: Requiert permissions administrateur.

#### GET `/system/status` - Statut SystÃ¨me T4G
**Response inclut**:
- SantÃ© du systÃ¨me
- Nombre total d'utilisateurs
- Nombre de transactions
- Services actifs
- Distribution des niveaux
- Ã‰conomie des tokens

## âš¡ Endpoints Lightning/Bitcoin

### `/api/v1/token4good/lightning`

#### POST `/invoice/create` - CrÃ©er une Facture Lightning
**Body**:
```json
{
  "amount": 50000,
  "memo": "Paiement service Token4Good",
  "expiry": 3600
}
```

**Response**:
```json
{
  "status": "success",
  "payment_request": "lnbc500u1p...",
  "payment_hash": "abc123...",
  "checking_id": "check_xyz",
  "amount": 50000,
  "expiry": 3600
}
```

#### GET `/balance` - Solde Lightning
**Response**:
```json
{
  "status": "success",
  "balance_sats": 125000,
  "balance_msats": 125000000,
  "wallet_id": "wallet_t4g_001"
}
```

#### POST `/invoice/pay` - Payer une Facture Lightning
**Body**:
```json
{
  "bolt11": "lnbc500u1p..."
}
```

#### GET `/invoice/check/:payment_hash` - VÃ©rifier un Paiement
**Response**:
```json
{
  "status": "success",
  "payment_hash": "abc123...",
  "paid": true,
  "details": {
    "amount": 50000,
    "status": "paid",
    "timestamp": "2025-01-10T16:00:00Z"
  }
}
```

#### GET `/node/info` - Informations NÅ“ud Lightning
#### GET `/channels` - Canaux Lightning
#### GET `/status` - Statut Lightning

## ğŸš¨ Gestion d'Erreurs

### Codes de Statut HTTP
- `200` - SuccÃ¨s
- `201` - CrÃ©Ã©
- `400` - RequÃªte invalide
- `401` - Non authentifiÃ© (token JWT manquant/invalide)
- `403` - Interdit (permissions insuffisantes)
- `404` - Non trouvÃ©
- `429` - Trop de requÃªtes (rate limit)
- `500` - Erreur serveur

### Format des Erreurs
```json
{
  "detail": "Message d'erreur descriptif",
  "error": {
    "type": "ValidationError",
    "field": "user_id",
    "message": "User ID requis"
  }
}
```

## âœ… Best Practices d'ImplÃ©mentation

### Authentification
- âœ… Utiliser le mÃªme token JWT que l'API MCP principale
- âœ… Renouveler le token avant expiration
- âœ… Valider JWT dans middleware avant chaque endpoint
- âŒ Ne pas exposer le token dans le code source

### Validation des DonnÃ©es
- âœ… VÃ©rifier tous les champs requis
- âœ… Valider les formats (email, user_id, etc.)
- âœ… VÃ©rifier les limites (tokens >= 0, etc.)
- âœ… Sanitizer les inputs

### Gestion des Tokens T4G
- âœ… VÃ©rifier le solde avant transactions
- âœ… ImplÃ©menter retry logic pour paiements
- âœ… Logger toutes transactions importantes
- âœ… VÃ©rifier permissions utilisateur

### Marketplace
- âœ… VÃ©rifier disponibilitÃ© avant rÃ©servation
- âœ… GÃ©rer annulations proprement
- âœ… Collecter et analyser feedbacks
- âœ… VÃ©rifier solde client avant rÃ©servation

### Lightning Network
- âœ… VÃ©rifier statut paiements rÃ©guliÃ¨rement
- âœ… GÃ©rer timeouts de factures
- âœ… Monitorer canaux Lightning
- âŒ Ne pas supposer qu'un paiement est instantanÃ©

## ğŸ† SystÃ¨me de Niveaux T4G

### Contributeur (0-500 T4G)
- AccÃ¨s aux services de base
- Peut participer aux sessions de mentoring
- Peut recevoir des tokens

### Mentor (500-1500 T4G)
- AccÃ¨s marketplace complÃ¨te
- Bonus 10% sur tous les gains
- Peut crÃ©er des services personnalisÃ©s
- PrioritÃ© sur les rÃ©servations

### Expert (1500+ T4G)
- Services premium exclusifs
- PrioritÃ© support
- Influence sur les dÃ©cisions communautaires
- Leadership et reconnaissance

## ğŸ“Š MÃ©triques de Performance

- **RÃ©ponse API cible**: <10ms (p50), <50ms (p95)
- **Lightning operations**: ~120ms (dÃ©pendance externe)
- **Rate limit**: 100 req/min par utilisateur
- **Cache**: Stats publiques et leaderboard

## ğŸ”— RÃ©fÃ©rences

- Documentation complÃ¨te: [_SPECS/api-pour-t4g-daznode.md](mdc:_SPECS/api-pour-t4g-daznode.md)
- Architecture globale: [architecture-token4good.mdc](mdc:.cursor/rules/architecture-token4good.mdc)
- Backend Rust: [backend-rust.mdc](mdc:.cursor/rules/backend-rust.mdc)
