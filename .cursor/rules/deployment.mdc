---
globs: token4good-backend/Dockerfile,railway.json,vercel.json,scripts/deploy-*.sh
description: Standards de d√©ploiement production Token4Good
---

# Deployment Standards - Production

## Target Date : 28 octobre 2025 üöÄ

## Architecture Production

```
Frontend (Vercel)          Backend (Railway)           Blockchain
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ          ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ           ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
t4g.dazno.de       ‚Üê‚Üí     api.token4good.com   ‚Üê‚Üí     RGB + Lightning
Next.js 13                Rust + Axum                  Bitcoin L2
Port 443 (HTTPS)          Port 8080                    LND Node
```

## Backend Deployment (Railway)

### Configuration
Fichier : [railway.json](mdc:token4good-backend/railway.json)

### Variables d'Environnement
```bash
DATABASE_URL=postgresql://...
JWT_SECRET=***
LND_REST_URL=https://...
LND_MACAROON=***
DAZNO_API_KEY=***
RUST_LOG=info
PORT=8080
```

### Script D√©ploiement
```bash
cd token4good-backend
railway init
railway add -d postgres
./railway-deploy.sh
```

### Dockerfile
Fichier : [Dockerfile](mdc:token4good-backend/Dockerfile)
- Multi-stage build
- Rust compilation optimis√©e
- Image finale : debian:bookworm-slim
- Taille : ~100MB

## Frontend Deployment (Vercel)

### Configuration
Fichier : [vercel.json](mdc:vercel.json)

### Variables d'Environnement
```bash
NEXT_PUBLIC_API_URL=https://api.token4good.com
NEXT_PUBLIC_USE_POSTGRES=true
NEXT_PUBLIC_SUPABASE_URL=***
NEXT_PUBLIC_SUPABASE_ANON_KEY=***
```

### Script D√©ploiement
```bash
./deploy-vercel-v2.sh --prod
```

### DNS Configuration
- Domain : `t4g.dazno.de`
- CNAME : Vercel endpoint
- SSL : Auto (Let's Encrypt)

## Database (Supabase)

### Configuration
- PostgreSQL 15
- Connection pooling : 6543
- Backups automatiques : quotidiens
- Replication : activ√©e

### Migrations
Auto-appliqu√©es via SQLx au d√©marrage du backend

## Monitoring

### Health Checks
```bash
# Backend
curl https://api.token4good.com/health

# Frontend
curl https://t4g.dazno.de/api/health
```

### Logs
```bash
# Backend
railway logs --follow

# Frontend
vercel logs --follow
```

### M√©triques √† Surveiller
- API latency (p50, p95, p99)
- Error rate par endpoint
- Database connection pool
- Lightning payment success rate
- RGB contract creation rate

## Rollback Procedure
```bash
# Backend
railway rollback

# Frontend
vercel rollback
```

## Secrets Rotation

### Schedule
| Secret | Fr√©quence | Prochain |
|--------|-----------|----------|
| JWT_SECRET | 90 jours | 30 d√©c 2025 |
| DATABASE_URL | 90 jours | 30 d√©c 2025 |
| LND_MACAROON | 180 jours | 30 mars 2026 |
| DAZNO_API_KEY | 180 jours | 30 mars 2026 |

### Guide
Documentation : [SECRETS_ROTATION_GUIDE.md](mdc:SECRETS_ROTATION_GUIDE.md)

## Pre-Deployment Checklist

### Backend
- [ ] Tests passent √† 100%
- [ ] Build Docker r√©ussit
- [ ] Variables d'environnement configur√©es
- [ ] LND accessible
- [ ] PostgreSQL migrations OK

### Frontend
- [ ] Build Next.js r√©ussit
- [ ] Routes API supprim√©es
- [ ] Variables d'environnement configur√©es
- [ ] DNS configur√©
- [ ] SSL actif

### Production
- [ ] Backup database complet
- [ ] Monitoring actif
- [ ] Alerting configur√©
- [ ] Rollback plan test√©
- [ ] Support team notifi√©

## Documentation
- Guide complet : [DEPLOYMENT_GUIDE.md](mdc:DEPLOYMENT_GUIDE.md)
- Production : [PRODUCTION_DEPLOYMENT.md](mdc:PRODUCTION_DEPLOYMENT.md)
- Quick Start : [QUICKSTART.md](mdc:QUICKSTART.md)
